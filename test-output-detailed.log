
> vowswapping@0.1.0 test:all
> ./run-all-tests.sh

[1;33m=== VowSwap Test Suite Runner ===[0m

[1;33mRunning Database Integration Tests...[0m
[1;33mRunning Database Integration Tests[0m
======================================
[1;33mSetting up test database...[0m
Resetting database and applying migrations...
Removing existing database file: /Users/jessedarsinos/VowSwapping/prisma/dev.db
Applying migrations...
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": SQLite database "dev.db" at "file:./dev.db"

SQLite database dev.db created at file:./dev.db

No migration found in prisma/migrations


No pending migrations to apply.
Migrations applied successfully!
Generating Prisma client...
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma

✔ Generated Prisma Client (v5.22.0) to ./node_modules/@prisma/client in 55ms

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Tip: Want to react to database changes in your app as they happen? Discover how with Pulse: https://pris.ly/tip-1-pulse

Prisma client generated successfully!
Database reset and migrations applied successfully!
[1;33mRunning Prisma model tests...[0m
FAIL __tests__/database/prisma-models.test.js
  Prisma Models and Relationships
    User Model
      ✕ should create a user with basic fields (54 ms)
      ✕ should enforce unique email constraint (50 ms)
      ✕ should update user fields correctly (49 ms)
    Product Model
      ✕ should create a product with all fields
      ✕ should retrieve a product with its seller (1 ms)
    Order and OrderItem Models
      ✕ should create an order with order items
      ✕ should retrieve an order with its items and products
    Address Model
      ✕ should create an address for a user (1 ms)
      ✕ should retrieve all addresses for a user
    Wishlist Model
      ✕ should add a product to user wishlist
      ✕ should enforce unique constraint on user-product combination
      ✕ should retrieve wishlist items with product details
    Review Model
      ✕ should create a product review
      ✕ should create a seller review
      ✕ should retrieve product reviews with details

  ● Prisma Models and Relationships › User Model › should create a user with basic fields

    expect(received).toBeDefined()

    Received: undefined

      39 |
      40 |       // Assert
    > 41 |       expect(user).toBeDefined();
         |                    ^
      42 |       expect(user.id).toBeDefined();
      43 |       expect(user.email).toBe(email);
      44 |       expect(user.name).toBe(name);

      at Object.toBeDefined (__tests__/database/prisma-models.test.js:41:20)

  ● Prisma Models and Relationships › User Model › should enforce unique email constraint

    expect(received).rejects.toThrow()

    Matcher error: received value must be a promise or a function returning a promise

    Received has value: undefined

      74 |           },
      75 |         })
    > 76 |       ).rejects.toThrow(); // Should throw due to unique constraint
         |                 ^
      77 |
      78 |       // Clean up
      79 |       await prisma.user.delete({ where: { id: user.id } });

      at Object.toThrow (node_modules/expect/build/index.js:204:13)
      at Object.toThrow (__tests__/database/prisma-models.test.js:76:17)

  ● Prisma Models and Relationships › User Model › should update user fields correctly

    TypeError: Cannot read properties of undefined (reading 'id')

      93 |       // Act
      94 |       const updatedUser = await prisma.user.update({
    > 95 |         where: { id: user.id },
         |                           ^
      96 |         data: {
      97 |           name: 'Updated Name',
      98 |           image: 'https://example.com/image.jpg',

      at Object.id (__tests__/database/prisma-models.test.js:95:27)

  ● Prisma Models and Relationships › Product Model › should create a product with all fields

    TypeError: Cannot read properties of undefined (reading 'id')

      142 |         tags: JSON.stringify(['test', 'product']),
      143 |         featured: true,
    > 144 |         sellerId: testUser.id,
          |                            ^
      145 |       };
      146 |
      147 |       // Act

      at Object.id (__tests__/database/prisma-models.test.js:144:28)

  ● Prisma Models and Relationships › Product Model › should retrieve a product with its seller

    TypeError: Cannot read properties of undefined (reading 'id')

      175 |           condition: 'LIKE_NEW',
      176 |           tags: JSON.stringify(['test']),
    > 177 |           sellerId: testUser.id,
          |                              ^
      178 |         },
      179 |       });
      180 |

      at Object.id (__tests__/database/prisma-models.test.js:177:30)

  ● Prisma Models and Relationships › Order and OrderItem Models › should create an order with order items

    TypeError: Cannot read properties of undefined (reading 'id')

      219 |           condition: 'NEW',
      220 |           tags: JSON.stringify(['order', 'test']),
    > 221 |           sellerId: testUser.id,
          |                              ^
      222 |         },
      223 |       });
      224 |     });

      at Object.id (__tests__/database/prisma-models.test.js:221:30)

  ● Prisma Models and Relationships › Order and OrderItem Models › should retrieve an order with its items and products

    TypeError: Cannot read properties of undefined (reading 'id')

      219 |           condition: 'NEW',
      220 |           tags: JSON.stringify(['order', 'test']),
    > 221 |           sellerId: testUser.id,
          |                              ^
      222 |         },
      223 |       });
      224 |     });

      at Object.id (__tests__/database/prisma-models.test.js:221:30)

  ● Prisma Models and Relationships › Address Model › should create an address for a user

    TypeError: Cannot read properties of undefined (reading 'id')

      340 |       // Arrange
      341 |       const addressData = {
    > 342 |         userId: testUser.id,
          |                          ^
      343 |         name: 'Home',
      344 |         street: '123 Test St',
      345 |         city: 'Test City',

      at Object.id (__tests__/database/prisma-models.test.js:342:26)

  ● Prisma Models and Relationships › Address Model › should retrieve all addresses for a user

    TypeError: Cannot read properties of undefined (reading 'id')

      371 |       const address1 = await prisma.address.create({
      372 |         data: {
    > 373 |           userId: testUser.id,
          |                            ^
      374 |           name: 'Home',
      375 |           street: '123 Home St',
      376 |           city: 'Home City',

      at Object.id (__tests__/database/prisma-models.test.js:373:28)

  ● Prisma Models and Relationships › Wishlist Model › should add a product to user wishlist

    TypeError: Cannot read properties of undefined (reading 'id')

      435 |           condition: 'NEW',
      436 |           tags: JSON.stringify(['wishlist', 'test']),
    > 437 |           sellerId: testUser.id,
          |                              ^
      438 |         },
      439 |       });
      440 |     });

      at Object.id (__tests__/database/prisma-models.test.js:437:30)

  ● Prisma Models and Relationships › Wishlist Model › should enforce unique constraint on user-product combination

    TypeError: Cannot read properties of undefined (reading 'id')

      435 |           condition: 'NEW',
      436 |           tags: JSON.stringify(['wishlist', 'test']),
    > 437 |           sellerId: testUser.id,
          |                              ^
      438 |         },
      439 |       });
      440 |     });

      at Object.id (__tests__/database/prisma-models.test.js:437:30)

  ● Prisma Models and Relationships › Wishlist Model › should retrieve wishlist items with product details

    TypeError: Cannot read properties of undefined (reading 'id')

      435 |           condition: 'NEW',
      436 |           tags: JSON.stringify(['wishlist', 'test']),
    > 437 |           sellerId: testUser.id,
          |                              ^
      438 |         },
      439 |       });
      440 |     });

      at Object.id (__tests__/database/prisma-models.test.js:437:30)

  ● Prisma Models and Relationships › Review Model › should create a product review

    TypeError: Cannot read properties of undefined (reading 'id')

      553 |           condition: 'NEW',
      554 |           tags: JSON.stringify(['review', 'test']),
    > 555 |           sellerId: testSeller.id,
          |                                ^
      556 |         },
      557 |       });
      558 |     });

      at Object.id (__tests__/database/prisma-models.test.js:555:32)

  ● Prisma Models and Relationships › Review Model › should create a seller review

    TypeError: Cannot read properties of undefined (reading 'id')

      553 |           condition: 'NEW',
      554 |           tags: JSON.stringify(['review', 'test']),
    > 555 |           sellerId: testSeller.id,
          |                                ^
      556 |         },
      557 |       });
      558 |     });

      at Object.id (__tests__/database/prisma-models.test.js:555:32)

  ● Prisma Models and Relationships › Review Model › should retrieve product reviews with details

    TypeError: Cannot read properties of undefined (reading 'id')

      553 |           condition: 'NEW',
      554 |           tags: JSON.stringify(['review', 'test']),
    > 555 |           sellerId: testSeller.id,
          |                                ^
      556 |         },
      557 |       });
      558 |     });

      at Object.id (__tests__/database/prisma-models.test.js:555:32)

---------------------------------------------|---------|----------|---------|---------|-------------------
File                                         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
---------------------------------------------|---------|----------|---------|---------|-------------------
All files                                    |       0 |        0 |       0 |       0 |                   
 src                                         |       0 |        0 |       0 |       0 |                   
  middleware.ts                              |       0 |        0 |       0 |       0 | 6-39              
 src/app                                     |       0 |      100 |       0 |       0 |                   
  layout.tsx                                 |       0 |      100 |       0 |       0 | 8-18              
  not-found.tsx                              |       0 |      100 |       0 |       0 | 4                 
  page.tsx                                   |       0 |      100 |       0 |       0 | 7-131             
 src/app/admin                               |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 9-59              
 src/app/admin/products                      |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 23-226            
 src/app/admin/products/create               |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 22-401            
 src/app/admin/products/edit/[id]            |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 30-489            
 src/app/api/auth/[...nextauth]              |       0 |      100 |     100 |       0 |                   
  route.ts                                   |       0 |      100 |     100 |       0 | 4                 
 src/app/api/auth/forgot-password            |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-75              
 src/app/api/auth/register                   |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-118             
 src/app/api/auth/reset-password             |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 6-56              
 src/app/api/auth/signin-after-register      |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 11-93             
 src/app/api/auth/verify-email               |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 5-117             
 src/app/api/orders                          |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-132             
 src/app/api/payments/create-intent          |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 9-69              
 src/app/api/payments/webhook                |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-151             
 src/app/api/products                        |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 10-208            
 src/app/api/products/[id]                   |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 9-217             
 src/app/api/reviews/product/[id]            |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-125             
 src/app/api/reviews/product/[id]/[reviewId] |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-172             
 src/app/api/reviews/seller/[id]             |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-164             
 src/app/api/reviews/seller/[id]/[reviewId]  |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-233             
 src/app/api/reviews/user                    |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-49              
 src/app/api/seller/products                 |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-153             
 src/app/api/seller/products/[id]            |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 11-208            
 src/app/api/seller/register                 |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-93              
 src/app/api/seller/stats                    |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-81              
 src/app/api/seller/status                   |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-44              
 src/app/api/sellers                         |       0 |      100 |       0 |       0 |                   
  route.ts                                   |       0 |      100 |       0 |       0 | 5-45              
 src/app/api/upload                          |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-44              
 src/app/api/user/addresses                  |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-114             
 src/app/api/user/addresses/[id]             |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-171             
 src/app/api/user/profile                    |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-51              
 src/app/api/user/wishlist                   |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 13-119            
 src/app/api/user/wishlist/[productId]       |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 21-101            
 src/app/auth/forgot-password                |       0 |      100 |       0 |       0 |                   
  page.tsx                                   |       0 |      100 |       0 |       0 | 5-11              
 src/app/auth/reset-password                 |       0 |      100 |       0 |       0 |                   
  page.tsx                                   |       0 |      100 |       0 |       0 | 5-11              
 src/app/auth/signin                         |       0 |      100 |       0 |       0 |                   
  page.tsx                                   |       0 |      100 |       0 |       0 | 4-10              
 src/app/auth/signup                         |       0 |      100 |       0 |       0 |                   
  page.tsx                                   |       0 |      100 |       0 |       0 | 4-10              
 src/app/auth/verify-email                   |       0 |      100 |       0 |       0 |                   
  page.tsx                                   |       0 |      100 |       0 |       0 | 5-11              
 src/app/cart                                |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 11-187            
 src/app/checkout                            |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 35-366            
 src/app/checkout/success                    |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 9-107             
 src/app/products                            |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 7-33              
 src/app/products/[id]                       |       0 |        0 |       0 |       0 |                   
  not-found.tsx                              |       0 |      100 |       0 |       0 | 4                 
  page.tsx                                   |       0 |        0 |       0 |       0 | 17-233            
 src/app/products/category/[category]        |       0 |      100 |       0 |       0 |                   
  page.tsx                                   |       0 |      100 |       0 |       0 | 12-24             
 src/app/profile                             |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 6-18              
 src/app/profile/addresses                   |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 7-33              
 src/app/profile/orders                      |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 6-18              
 src/app/profile/reviews                     |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 10-156            
 src/app/profile/wishlist                    |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 12-155            
 src/app/seller/dashboard                    |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 19-289            
 src/app/seller/pending                      |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 9-70              
 src/app/seller/products                     |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 12-234            
 src/app/seller/products/create              |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 14-379            
 src/app/seller/products/edit/[id]           |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 14-432            
 src/app/seller/register                     |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 12-163            
 src/app/shop/[id]                           |       0 |        0 |       0 |       0 |                   
  not-found.tsx                              |       0 |      100 |       0 |       0 | 4                 
  page.tsx                                   |       0 |        0 |       0 |       0 | 18-248            
 src/app/shops                               |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 8-92              
 src/components/auth                         |       0 |        0 |       0 |       0 |                   
  AuthProvider.tsx                           |       0 |        0 |       0 |       0 | 8-20              
  EmailVerification.tsx                      |       0 |        0 |       0 |       0 | 8-143             
  PasswordResetForm.tsx                      |       0 |        0 |       0 |       0 | 10-199            
  SignInForm.tsx                             |       0 |        0 |       0 |       0 | 11-110            
  SignUpForm.tsx                             |       0 |        0 |       0 |       0 | 10-114            
 src/components/layout                       |       0 |        0 |       0 |       0 |                   
  Footer.tsx                                 |       0 |      100 |       0 |       0 | 4                 
  Navbar.tsx                                 |       0 |        0 |       0 |       0 | 10-198            
 src/components/payment                      |       0 |        0 |       0 |       0 |                   
  StripePaymentForm.tsx                      |       0 |        0 |       0 |       0 | 14-125            
 src/components/product                      |       0 |        0 |       0 |       0 |                   
  AddToCartButton.tsx                        |       0 |        0 |       0 |       0 | 12-38             
  ProductCard.tsx                            |       0 |        0 |       0 |       0 | 15-66             
  ProductFilters.tsx                         |       0 |        0 |       0 |       0 | 25-225            
  ProductGrid.tsx                            |       0 |        0 |       0 |       0 | 10-19             
  WishlistButton.tsx                         |       0 |        0 |       0 |       0 | 20-57             
 src/components/profile                      |       0 |        0 |       0 |       0 |                   
  AddressManager.tsx                         |       0 |        0 |       0 |       0 | 9-399             
  OrderHistory.tsx                           |       0 |        0 |       0 |       0 | 22-168            
  ProfileForm.tsx                            |       0 |        0 |       0 |       0 | 10-72             
 src/components/review                       |       0 |        0 |       0 |       0 |                   
  ProductReviews.tsx                         |       0 |        0 |       0 |       0 | 13-81             
  ProductReviewsWrapper.tsx                  |       0 |      100 |       0 |       0 | 7-25              
  ReviewCard.tsx                             |       0 |        0 |       0 |       0 | 13-22             
  ReviewForm.tsx                             |       0 |        0 |       0 |       0 | 13-141            
  ReviewList.tsx                             |       0 |        0 |       0 |       0 | 13-77             
  SellerReviews.tsx                          |       0 |        0 |       0 |       0 | 13-83             
  SellerReviewsWrapper.tsx                   |       0 |      100 |       0 |       0 | 7-25              
  StarRating.tsx                             |       0 |        0 |       0 |       0 | 13-91             
 src/context                                 |       0 |      100 |       0 |       0 |                   
  AuthContext.tsx                            |       0 |      100 |       0 |       0 | 11                
 src/lib                                     |       0 |        0 |       0 |       0 |                   
  auth.ts                                    |       0 |        0 |       0 |       0 | 7-175             
  cloudinary.ts                              |       0 |        0 |       0 |       0 | 4-78              
  prisma.ts                                  |       0 |        0 |       0 |       0 | 4-38              
  products.ts                                |       0 |        0 |       0 |       0 | 7-276             
  session.ts                                 |       0 |        0 |       0 |       0 | 5-15              
  stripe.ts                                  |       0 |      100 |     100 |       0 | 4                 
 src/store                                   |       0 |        0 |       0 |       0 |                   
  authStore.ts                               |       0 |      100 |       0 |       0 | 18-22             
  cartStore.ts                               |       0 |        0 |       0 |       0 | 26-118            
  reviewStore.ts                             |       0 |        0 |       0 |       0 | 60-242            
  wishlistStore.ts                           |       0 |        0 |       0 |       0 | 34-81             
 src/types                                   |       0 |        0 |       0 |       0 |                   
  product.ts                                 |       0 |        0 |       0 |       0 |                   
---------------------------------------------|---------|----------|---------|---------|-------------------
Jest: "global" coverage threshold for statements (70%) not met: 0%
Jest: "global" coverage threshold for branches (70%) not met: 0%
Jest: "global" coverage threshold for lines (70%) not met: 0%
Jest: "global" coverage threshold for functions (70%) not met: 0%
Test Suites: 1 failed, 1 total
Tests:       15 failed, 15 total
Snapshots:   0 total
Time:        1.702 s
Ran all test suites matching /__tests__\/database\/prisma-models.test.js/i.
[1;33mRunning migration tests...[0m
FAIL __tests__/database/migrations.test.js
  Database Migrations
    Migration Structure
      ✕ should have valid migration files
    Migration Application
      ✕ should apply migrations successfully (527 ms)
    Schema Validation
      ✓ should validate the current schema against migrations (484 ms)
    Seller Fields Migration
      ✕ should have applied seller fields to User model
      ✕ should have applied approved field to Product model
    Wishlist Migration
      ✕ should have created Wishlist model with correct relations
    Review Migration
      ✕ should have created Review model with correct relations

  ● Database Migrations › Migration Structure › should have valid migration files

    ENOENT: no such file or directory, scandir '/Users/jessedarsinos/VowSwapping/prisma/migrations'

      23 |       // Get all migration directories
      24 |       const migrationsPath = path.join(process.cwd(), 'prisma', 'migrations');
    > 25 |       const migrationDirs = fs.readdirSync(migrationsPath)
         |                                ^
      26 |         .filter(dir => fs.statSync(path.join(migrationsPath, dir)).isDirectory());
      27 |
      28 |       // Verify each migration directory has a migration.sql file

      at Object.readdirSync (__tests__/database/migrations.test.js:25:32)

  ● Database Migrations › Migration Application › should apply migrations successfully

    TypeError: Cannot read properties of undefined (reading 'map')

      69 |         
      70 |         // Check for expected tables
    > 71 |         const tableNames = tables.map(t => t.name);
         |                                   ^
      72 |         expect(tableNames).toContain('User');
      73 |         expect(tableNames).toContain('Product');
      74 |         expect(tableNames).toContain('Order');

      at Object.map (__tests__/database/migrations.test.js:71:35)

  ● Database Migrations › Seller Fields Migration › should have applied seller fields to User model

    TypeError: Cannot read properties of undefined (reading 'isSeller')

      126 |
      127 |       // Verify seller fields were saved
    > 128 |       expect(user.isSeller).toBe(true);
          |                   ^
      129 |       expect(user.sellerApproved).toBe(true);
      130 |       expect(user.shopName).toBe('Test Shop');
      131 |       expect(user.shopDescription).toBe('A test shop for migration testing');

      at Object.isSeller (__tests__/database/migrations.test.js:128:19)

  ● Database Migrations › Seller Fields Migration › should have applied approved field to Product model

    TypeError: Cannot read properties of undefined (reading 'id')

      156 |           condition: 'NEW',
      157 |           tags: JSON.stringify(['test']),
    > 158 |           sellerId: user.id,
          |                          ^
      159 |           approved: true,
      160 |         },
      161 |       });

      at Object.id (__tests__/database/migrations.test.js:158:26)

  ● Database Migrations › Wishlist Migration › should have created Wishlist model with correct relations

    TypeError: Cannot read properties of undefined (reading 'id')

      190 |           condition: 'NEW',
      191 |           tags: JSON.stringify(['wishlist']),
    > 192 |           sellerId: user.id,
          |                          ^
      193 |         },
      194 |       });
      195 |

      at Object.id (__tests__/database/migrations.test.js:192:26)

  ● Database Migrations › Review Migration › should have created Review model with correct relations

    TypeError: Cannot read properties of undefined (reading 'id')

      253 |           condition: 'NEW',
      254 |           tags: JSON.stringify(['review']),
    > 255 |           sellerId: seller.id,
          |                            ^
      256 |         },
      257 |       });
      258 |

      at Object.id (__tests__/database/migrations.test.js:255:28)

---------------------------------------------|---------|----------|---------|---------|-------------------
File                                         | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
---------------------------------------------|---------|----------|---------|---------|-------------------
All files                                    |       0 |        0 |       0 |       0 |                   
 src                                         |       0 |        0 |       0 |       0 |                   
  middleware.ts                              |       0 |        0 |       0 |       0 | 6-39              
 src/app                                     |       0 |      100 |       0 |       0 |                   
  layout.tsx                                 |       0 |      100 |       0 |       0 | 8-18              
  not-found.tsx                              |       0 |      100 |       0 |       0 | 4                 
  page.tsx                                   |       0 |      100 |       0 |       0 | 7-131             
 src/app/admin                               |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 9-59              
 src/app/admin/products                      |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 23-226            
 src/app/admin/products/create               |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 22-401            
 src/app/admin/products/edit/[id]            |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 30-489            
 src/app/api/auth/[...nextauth]              |       0 |      100 |     100 |       0 |                   
  route.ts                                   |       0 |      100 |     100 |       0 | 4                 
 src/app/api/auth/forgot-password            |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-75              
 src/app/api/auth/register                   |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-118             
 src/app/api/auth/reset-password             |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 6-56              
 src/app/api/auth/signin-after-register      |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 11-93             
 src/app/api/auth/verify-email               |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 5-117             
 src/app/api/orders                          |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-132             
 src/app/api/payments/create-intent          |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 9-69              
 src/app/api/payments/webhook                |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-151             
 src/app/api/products                        |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 10-208            
 src/app/api/products/[id]                   |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 9-217             
 src/app/api/reviews/product/[id]            |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-125             
 src/app/api/reviews/product/[id]/[reviewId] |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-172             
 src/app/api/reviews/seller/[id]             |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-164             
 src/app/api/reviews/seller/[id]/[reviewId]  |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-233             
 src/app/api/reviews/user                    |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-49              
 src/app/api/seller/products                 |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-153             
 src/app/api/seller/products/[id]            |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 11-208            
 src/app/api/seller/register                 |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-93              
 src/app/api/seller/stats                    |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-81              
 src/app/api/seller/status                   |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-44              
 src/app/api/sellers                         |       0 |      100 |       0 |       0 |                   
  route.ts                                   |       0 |      100 |       0 |       0 | 5-45              
 src/app/api/upload                          |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 8-44              
 src/app/api/user/addresses                  |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-114             
 src/app/api/user/addresses/[id]             |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-171             
 src/app/api/user/profile                    |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 7-51              
 src/app/api/user/wishlist                   |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 13-119            
 src/app/api/user/wishlist/[productId]       |       0 |        0 |       0 |       0 |                   
  route.ts                                   |       0 |        0 |       0 |       0 | 21-101            
 src/app/auth/forgot-password                |       0 |      100 |       0 |       0 |                   
  page.tsx                                   |       0 |      100 |       0 |       0 | 5-11              
 src/app/auth/reset-password                 |       0 |      100 |       0 |       0 |                   
  page.tsx                                   |       0 |      100 |       0 |       0 | 5-11              
 src/app/auth/signin                         |       0 |      100 |       0 |       0 |                   
  page.tsx                                   |       0 |      100 |       0 |       0 | 4-10              
 src/app/auth/signup                         |       0 |      100 |       0 |       0 |                   
  page.tsx                                   |       0 |      100 |       0 |       0 | 4-10              
 src/app/auth/verify-email                   |       0 |      100 |       0 |       0 |                   
  page.tsx                                   |       0 |      100 |       0 |       0 | 5-11              
 src/app/cart                                |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 11-187            
 src/app/checkout                            |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 35-366            
 src/app/checkout/success                    |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 9-107             
 src/app/products                            |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 7-33              
 src/app/products/[id]                       |       0 |        0 |       0 |       0 |                   
  not-found.tsx                              |       0 |      100 |       0 |       0 | 4                 
  page.tsx                                   |       0 |        0 |       0 |       0 | 17-233            
 src/app/products/category/[category]        |       0 |      100 |       0 |       0 |                   
  page.tsx                                   |       0 |      100 |       0 |       0 | 12-24             
 src/app/profile                             |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 6-18              
 src/app/profile/addresses                   |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 7-33              
 src/app/profile/orders                      |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 6-18              
 src/app/profile/reviews                     |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 10-156            
 src/app/profile/wishlist                    |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 12-155            
 src/app/seller/dashboard                    |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 19-289            
 src/app/seller/pending                      |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 9-70              
 src/app/seller/products                     |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 12-234            
 src/app/seller/products/create              |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 14-379            
 src/app/seller/products/edit/[id]           |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 14-432            
 src/app/seller/register                     |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 12-163            
 src/app/shop/[id]                           |       0 |        0 |       0 |       0 |                   
  not-found.tsx                              |       0 |      100 |       0 |       0 | 4                 
  page.tsx                                   |       0 |        0 |       0 |       0 | 18-248            
 src/app/shops                               |       0 |        0 |       0 |       0 |                   
  page.tsx                                   |       0 |        0 |       0 |       0 | 8-92              
 src/components/auth                         |       0 |        0 |       0 |       0 |                   
  AuthProvider.tsx                           |       0 |        0 |       0 |       0 | 8-20              
  EmailVerification.tsx                      |       0 |        0 |       0 |       0 | 8-143             
  PasswordResetForm.tsx                      |       0 |        0 |       0 |       0 | 10-199            
  SignInForm.tsx                             |       0 |        0 |       0 |       0 | 11-110            
  SignUpForm.tsx                             |       0 |        0 |       0 |       0 | 10-114            
 src/components/layout                       |       0 |        0 |       0 |       0 |                   
  Footer.tsx                                 |       0 |      100 |       0 |       0 | 4                 
  Navbar.tsx                                 |       0 |        0 |       0 |       0 | 10-198            
 src/components/payment                      |       0 |        0 |       0 |       0 |                   
  StripePaymentForm.tsx                      |       0 |        0 |       0 |       0 | 14-125            
 src/components/product                      |       0 |        0 |       0 |       0 |                   
  AddToCartButton.tsx                        |       0 |        0 |       0 |       0 | 12-38             
  ProductCard.tsx                            |       0 |        0 |       0 |       0 | 15-66             
  ProductFilters.tsx                         |       0 |        0 |       0 |       0 | 25-225            
  ProductGrid.tsx                            |       0 |        0 |       0 |       0 | 10-19             
  WishlistButton.tsx                         |       0 |        0 |       0 |       0 | 20-57             
 src/components/profile                      |       0 |        0 |       0 |       0 |                   
  AddressManager.tsx                         |       0 |        0 |       0 |       0 | 9-399             
  OrderHistory.tsx                           |       0 |        0 |       0 |       0 | 22-168            
  ProfileForm.tsx                            |       0 |        0 |       0 |       0 | 10-72             
 src/components/review                       |       0 |        0 |       0 |       0 |                   
  ProductReviews.tsx                         |       0 |        0 |       0 |       0 | 13-81             
  ProductReviewsWrapper.tsx                  |       0 |      100 |       0 |       0 | 7-25              
  ReviewCard.tsx                             |       0 |        0 |       0 |       0 | 13-22             
  ReviewForm.tsx                             |       0 |        0 |       0 |       0 | 13-141            
  ReviewList.tsx                             |       0 |        0 |       0 |       0 | 13-77             
  SellerReviews.tsx                          |       0 |        0 |       0 |       0 | 13-83             
  SellerReviewsWrapper.tsx                   |       0 |      100 |       0 |       0 | 7-25              
  StarRating.tsx                             |       0 |        0 |       0 |       0 | 13-91             
 src/context                                 |       0 |      100 |       0 |       0 |                   
  AuthContext.tsx                            |       0 |      100 |       0 |       0 | 11                
 src/lib                                     |       0 |        0 |       0 |       0 |                   
  auth.ts                                    |       0 |        0 |       0 |       0 | 7-175             
  cloudinary.ts                              |       0 |        0 |       0 |       0 | 4-78              
  prisma.ts                                  |       0 |        0 |       0 |       0 | 4-38              
  products.ts                                |       0 |        0 |       0 |       0 | 7-276             
  session.ts                                 |       0 |        0 |       0 |       0 | 5-15              
  stripe.ts                                  |       0 |      100 |     100 |       0 | 4                 
 src/store                                   |       0 |        0 |       0 |       0 |                   
  authStore.ts                               |       0 |      100 |       0 |       0 | 18-22             
  cartStore.ts                               |       0 |        0 |       0 |       0 | 26-118            
  reviewStore.ts                             |       0 |        0 |       0 |       0 | 60-242            
  wishlistStore.ts                           |       0 |        0 |       0 |       0 | 34-81             
 src/types                                   |       0 |        0 |       0 |       0 |                   
  product.ts                                 |       0 |        0 |       0 |       0 |                   
---------------------------------------------|---------|----------|---------|---------|-------------------
Jest: "global" coverage threshold for statements (70%) not met: 0%
Jest: "global" coverage threshold for branches (70%) not met: 0%
Jest: "global" coverage threshold for lines (70%) not met: 0%
Jest: "global" coverage threshold for functions (70%) not met: 0%
Test Suites: 1 failed, 1 total
Tests:       6 failed, 1 passed, 7 total
Snapshots:   0 total
Time:        2.12 s
Ran all test suites matching /__tests__\/database\/migrations.test.js/i.
[1;33mRunning data persistence tests...[0m
